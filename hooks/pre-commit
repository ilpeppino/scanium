#!/bin/bash
# Pre-commit hook for Scanium
# Runs ktlint on staged Kotlin files to enforce code style
# See docs/REVIEW_REPORT.md Section F.3 (DX-002)

set -e

# Get list of staged Kotlin files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.kt$|\.kts$' || true)

if [ -z "$STAGED_FILES" ]; then
    # No Kotlin files staged, skip linting
    exit 0
fi

echo "Running ktlint on staged Kotlin files..."
echo ""

# Run ktlint check on the staged files
# Using --relative flag for cleaner output
if ./gradlew ktlintCheck --console=plain -q 2>/dev/null; then
    echo ""
    echo "ktlint check passed."
    exit 0
else
    echo ""
    echo "ktlint check failed."
    echo ""
    echo "Options:"
    echo "  1. Run './gradlew ktlintFormat' to auto-fix issues"
    echo "  2. Fix issues manually"
    echo "  3. Use 'git commit --no-verify' to bypass (not recommended)"
    echo ""
    exit 1
fi
