# Application
NODE_ENV=development
PORT=8080

# Public URL (used to build OAuth callback URLs)
# For local dev: http://localhost:8080
# For NAS: https://api.yourdomain.com (Cloudflare Tunnel endpoint)
PUBLIC_BASE_URL=http://localhost:8080

# Database
# Require TLS everywhere. Generate strong credentials with:
#   openssl rand -base64 32
# Update POSTGRES_USER/POSTGRES_PASSWORD/POSTGRES_DB below to match.
DATABASE_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@postgres:5432/${POSTGRES_DB}?sslmode=require

# Cloud Classifier Proxy
# Comma-separated keys for X-API-Key header (no secrets committed)
SCANIUM_API_KEYS=dev-key
# mock or google
SCANIUM_CLASSIFIER_PROVIDER=mock
# Comma-separated Google Vision features (e.g., TEXT_DETECTION,IMAGE_PROPERTIES,LOGO_DETECTION)
VISION_FEATURE=LABEL_DETECTION,TEXT_DETECTION,IMAGE_PROPERTIES
# Max upload size in bytes (default 5MB)
MAX_UPLOAD_BYTES=5242880
# Rate limits and concurrency
CLASSIFIER_RATE_LIMIT_PER_MINUTE=60
CLASSIFIER_CONCURRENCY_LIMIT=2
# Domain pack config (path relative to repo root or dist)
DOMAIN_PACK_ID=home_resale
DOMAIN_PACK_PATH=src/modules/classifier/domain/home-resale.json
CLASSIFIER_RETAIN_UPLOADS=false
CLASSIFIER_MOCK_SEED=scanium-mock
VISION_TIMEOUT_MS=10000
VISION_MAX_RETRIES=2
# Google Vision credentials path (Service Account JSON)
GOOGLE_APPLICATION_CREDENTIALS=/secrets/vision-sa.json
# Optional: override docker-compose mount for remote config file
# REMOTE_CONFIG_PATH=./config/remote-config.json

# Vision Enrichment Configuration
# ================================
# The classifier has TWO separate Vision configurations:
# 1. SCANIUM_CLASSIFIER_PROVIDER - Controls classification (label detection for category mapping)
# 2. VISION_PROVIDER - Controls attribute enrichment (OCR, logos, colors, labels)
#
# These are INDEPENDENT - you can use mock classifier with real Vision enrichment.
# This is useful when you want Vision-extracted attributes but don't need category mapping.

# Vision provider for attribute enrichment: 'mock' or 'google'
# Set to 'google' for real Vision API extraction (OCR, logos, colors, labels)
VISION_PROVIDER=mock

# Enable Vision extraction globally
VISION_ENABLED=true

# Feature toggles for Vision extraction
VISION_ENABLE_OCR=true
VISION_ENABLE_LABELS=true
VISION_ENABLE_LOGOS=true
VISION_ENABLE_COLORS=true

# OCR mode: TEXT_DETECTION (simple) or DOCUMENT_TEXT_DETECTION (structured documents)
VISION_OCR_MODE=TEXT_DETECTION

# Limits and thresholds
VISION_MAX_OCR_SNIPPETS=10
VISION_MAX_LABEL_HINTS=10
VISION_MAX_LOGO_HINTS=5
VISION_MAX_COLORS=5
VISION_MAX_OCR_SNIPPET_LENGTH=100
VISION_MIN_OCR_CONFIDENCE=0.5
VISION_MIN_LABEL_CONFIDENCE=0.5
VISION_MIN_LOGO_CONFIDENCE=0.5

# Vision cache (reduces API calls for repeated images)
VISION_CACHE_TTL_SECONDS=21600
VISION_CACHE_MAX_ENTRIES=500

# Enable attribute enrichment in classify endpoint
CLASSIFIER_ENABLE_ATTRIBUTE_ENRICHMENT=true

# eBay OAuth Configuration
# Environment: sandbox or production
EBAY_ENV=sandbox

# Get these from eBay Developer Portal:
# Sandbox: https://developer.ebay.com/my/keys
# Production: Same portal, switch to Production keyset
EBAY_CLIENT_ID=your_ebay_client_id_here
EBAY_CLIENT_SECRET=your_ebay_client_secret_here
EBAY_TOKEN_ENCRYPTION_KEY=change_me_to_32+_char_secret_for_tokens

# OAuth callback path (appended to PUBLIC_BASE_URL)
EBAY_REDIRECT_PATH=/auth/ebay/callback

# eBay API Scopes (space-delimited)
# For selling: https://api.ebay.com/oauth/api_scope/sell.inventory
# For fulfillment: https://api.ebay.com/oauth/api_scope/sell.fulfillment
# For account: https://api.ebay.com/oauth/api_scope/sell.account
# Example full list:
EBAY_SCOPES=https://api.ebay.com/oauth/api_scope https://api.ebay.com/oauth/api_scope/sell.inventory https://api.ebay.com/oauth/api_scope/sell.fulfillment https://api.ebay.com/oauth/api_scope/sell.account

# AI Assistant Configuration
# Provider: mock, openai, or disabled
SCANIUM_ASSISTANT_PROVIDER=mock
# API keys for assistant endpoint (comma-separated)
SCANIUM_ASSISTANT_API_KEYS=dev-key
# OpenAI configuration (only if provider=openai)
OPENAI_API_KEY=
OPENAI_MODEL=gpt-4o-mini

# Assistant Rate Limiting
ASSIST_RATE_LIMIT_PER_MINUTE=60
ASSIST_IP_RATE_LIMIT_PER_MINUTE=60
ASSIST_DEVICE_RATE_LIMIT_PER_MINUTE=30
ASSIST_RATE_LIMIT_WINDOW_SECONDS=60
ASSIST_RATE_LIMIT_BACKOFF_SECONDS=30
ASSIST_RATE_LIMIT_BACKOFF_MAX_SECONDS=900

# Assistant Quotas and Limits
ASSIST_DAILY_QUOTA=200
ASSIST_MAX_INPUT_CHARS=2000
ASSIST_MAX_OUTPUT_TOKENS=500
ASSIST_MAX_CONTEXT_ITEMS=10
ASSIST_MAX_ATTRIBUTES_PER_ITEM=20
ASSIST_PROVIDER_TIMEOUT_MS=30000

# Assistant Logging (false in production, true for debugging only)
ASSIST_LOG_CONTENT=false

# Allow empty items in assistant requests (feature flag for testing)
# When true, the assistant will return a helpful message even without items attached
# When false (default), the assistant requires at least one item for personalized advice
SCANIUM_ASSISTANT_ALLOW_EMPTY_ITEMS=false

# Assistant Circuit Breaker
ASSIST_CIRCUIT_FAILURE_THRESHOLD=5
ASSIST_CIRCUIT_COOLDOWN_SECONDS=60
ASSIST_CIRCUIT_MIN_REQUESTS=3

# Optional: Redis for distributed rate limiting
# ASSIST_RATE_LIMIT_REDIS_URL=redis://localhost:6379

# HTTPS enforcement
SECURITY_ENFORCE_HTTPS=true
SECURITY_ENABLE_HSTS=true
# Allow HTTP on localhost/private networks only for explicit testing
ALLOW_INSECURE_HTTP=false

# Session Security
# Generate with: openssl rand -base64 64
SESSION_SIGNING_SECRET=REPLACE_WITH_RANDOM_BASE64_64_BYTES

# CORS Origins (comma-separated)
# Include your app scheme and dev origins. Wildcards are rejected.
# Example: scanium://,http://localhost:3000,https://yourdomain.com
CORS_ORIGINS=scanium://,http://localhost:3000

# Postgres (for docker-compose)
# NEVER leave these as defaultsâ€”use dedicated user/password per environment.
POSTGRES_USER=scanium_app
POSTGRES_PASSWORD=REPLACE_WITH_STRONG_RANDOM
POSTGRES_DB=scanium

# Cloudflare Tunnel (for NAS deployment)
# Get this from Cloudflare Zero Trust > Access > Tunnels
# Leave empty for local dev
CLOUDFLARED_TOKEN=
